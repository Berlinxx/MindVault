<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="mindvault.Pages.PlayerBuzzPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Shell.NavBarIsVisible="False">

  <!-- ===== Theme ===== -->
  <ContentPage.Resources>
    <Color x:Key="Primary">#31B6D8</Color>
    <Color x:Key="PrimaryDark">#0B57C1</Color>
    <Color x:Key="Ink">#0D3848</Color>
    <Color x:Key="Surface">#FFFFFF</Color>
    <Color x:Key="TextPrimary">#14181B</Color>
    <Color x:Key="TextSecondary">#5A6673</Color>

    <Style x:Key="Card" TargetType="Border">
      <Setter Property="BackgroundColor" Value="{StaticResource Surface}" />
      <Setter Property="StrokeThickness" Value="0" />
      <Setter Property="StrokeShape" Value="RoundRectangle 18" />
      <Setter Property="Padding" Value="16" />
      <Setter Property="Shadow">
        <Setter.Value>
          <Shadow Opacity="0.18" Radius="16">
            <Shadow.Offset><Point X="0" Y="10"/></Shadow.Offset>
          </Shadow>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="AnswerPill" TargetType="Border">
      <Setter Property="StrokeShape" Value="RoundRectangle 22" />
      <Setter Property="Padding" Value="20,12" />
      <Setter Property="HorizontalOptions" Value="Center" />
      <Setter Property="Background">
        <Setter.Value>
          <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#5EE2F5" Offset="0" />
            <GradientStop Color="#6C4DF7" Offset="1" />
          </LinearGradientBrush>
        </Setter.Value>
      </Setter>
    </Style>
  </ContentPage.Resources>

  <!-- Background -->
  <ContentPage.Background>
    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
      <GradientStop Color="#3CC5F0" Offset="0" />
      <GradientStop Color="#0B57C1" Offset="1" />
    </LinearGradientBrush>
  </ContentPage.Background>

  <VerticalStackLayout Spacing="0">
    <!-- Fixed Exit Button Header -->
    <Grid Padding="16,40,16,10" BackgroundColor="Transparent">
      <Border WidthRequest="50" HeightRequest="50"
              BackgroundColor="{StaticResource Surface}" StrokeThickness="0"
              StrokeShape="RoundRectangle 25" HorizontalOptions="End" VerticalOptions="Center"
              ToolTipProperties.Text="Exit game"
              SemanticProperties.Description="Exit button"
              SemanticProperties.Hint="Leaves the game and returns to home page">
        <Label Text="&#xF00D;" FontFamily="FontAwesome6FreeSolid" FontSize="20" TextColor="{StaticResource Ink}"
               HorizontalOptions="Center" VerticalOptions="Center"
               AutomationProperties.IsInAccessibleTree="False"/>
        <Border.GestureRecognizers>
          <TapGestureRecognizer Tapped="OnExitTapped"/>
        </Border.GestureRecognizers>
      </Border>
    </Grid>

    <!-- Main Content -->
    <ScrollView>
      <VerticalStackLayout Spacing="20" Padding="16,10,16,28" HorizontalOptions="Center" MaximumWidthRequest="{OnIdiom Phone=500, Desktop=600}">

        <Label x:Name="QuestionBadge" Text="Question 1 of 5" FontSize="30" TextColor="White" HorizontalTextAlignment="Center" FontAttributes="Bold" Margin="0,30,0,40"
               SemanticProperties.Description="Question progress"/>

        <!-- Buzz Winner Banner (shown when someone buzzes) -->
        <Border x:Name="BuzzWinnerBanner" IsVisible="False" Margin="0,0,0,20"
                BackgroundColor="{StaticResource Surface}" StrokeThickness="0" StrokeShape="RoundRectangle 18" Padding="16,12"
                SemanticProperties.Description="First player to buzz in"
                SemanticProperties.Hint="Shows which player will answer the question">
          <VerticalStackLayout Spacing="10">
            <Label Text="ðŸ”” BUZZING IN!" FontSize="12" FontAttributes="Bold" TextColor="{StaticResource Primary}"
                   HorizontalTextAlignment="Center"
                   SemanticProperties.Description="Buzz notification"/>
            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" HorizontalOptions="Center">
              <!-- Avatar -->
              <Border Grid.Column="0" WidthRequest="50" HeightRequest="50"
                      StrokeShape="Ellipse" StrokeThickness="2" Stroke="{StaticResource Primary}"
                      BackgroundColor="#E8DFFB"
                      SemanticProperties.Description="Player avatar">
                <Image x:Name="BuzzWinnerAvatar" Source="avatar1.png" Aspect="AspectFill"
                       AutomationProperties.IsInAccessibleTree="False">
                  <Image.Clip>
                    <EllipseGeometry Center="25,25" RadiusX="25" RadiusY="25"/>
                  </Image.Clip>
                </Image>
              </Border>
              <!-- Name -->
              <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                <Label x:Name="BuzzWinnerName" Text="Player Name" FontSize="18" FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}"
                       SemanticProperties.Description="Player name who buzzed"/>
                <Label Text="will answer!" FontSize="12" TextColor="{StaticResource TextSecondary}"
                       SemanticProperties.Description="Status text"/>
              </VerticalStackLayout>
            </Grid>
          </VerticalStackLayout>
        </Border>

      <!-- Big Bell Icon -->
      <Border x:Name="Bell" WidthRequest="200" HeightRequest="200"
              BackgroundColor="#F2B51E" StrokeThickness="0"
              StrokeShape="RoundRectangle 100" HorizontalOptions="Center"
              Padding="0"
              ToolTipProperties.Text="Buzz in to answer"
              SemanticProperties.Description="Buzz button"
              SemanticProperties.Hint="Tap to signal you know the answer">
        <Label Text="&#xF0F3;" FontFamily="FontAwesome6FreeSolid" FontSize="90" TextColor="White"
               HorizontalOptions="Center" VerticalOptions="Center"
               AutomationProperties.IsInAccessibleTree="False"/>
        <Border.GestureRecognizers>
          <TapGestureRecognizer Tapped="OnBellTapped"/>
        </Border.GestureRecognizers>
      </Border>

      <!-- Shared round timer visible to all -->
      <Border x:Name="TimerPanel" Style="{StaticResource AnswerPill}" IsVisible="False" Margin="0,0,0,20"
              SemanticProperties.Description="Answer timer"
              SemanticProperties.Hint="Time remaining to answer">
        <Label x:Name="TimerLabel" Text="10.0s" TextColor="Black" FontAttributes="Bold" FontSize="16" HorizontalOptions="Center" />
      </Border>

      <!-- Leaderboard -->
      <Border Style="{StaticResource Card}" Margin="0,115,0,0"
              SemanticProperties.Description="Player leaderboard"
              SemanticProperties.Hint="Shows current scores for all players">
        <VerticalStackLayout Spacing="10">
          <Label Text="LEADERBOARDS" FontAttributes="Bold" FontSize="13"
                 HorizontalTextAlignment="Center" TextColor="{StaticResource TextPrimary}"
                 SemanticProperties.HeadingLevel="Level2"
                 SemanticProperties.Description="Leaderboard heading"/>

          <ScrollView HeightRequest="320">
            <CollectionView ItemsSource="{Binding Scores}" SelectionMode="None"
                            SemanticProperties.Description="List of players and their scores">
              <CollectionView.ItemTemplate>
                <DataTemplate>
                  <Grid ColumnDefinitions="Auto,Auto,*,Auto" Padding="4,10" ColumnSpacing="10">
                    <Label Text="{Binding Rank}" FontSize="18" VerticalOptions="Center" TextColor="{StaticResource TextPrimary}"
                           SemanticProperties.Description="Player rank"/>

                    <Grid Grid.Column="1">
                      <Border WidthRequest="42" HeightRequest="42" StrokeShape="Ellipse" StrokeThickness="0" BackgroundColor="#E8DFFB"
                              SemanticProperties.Description="Player avatar">
                        <Image Source="{Binding Image}" Aspect="AspectFill"
                               AutomationProperties.IsInAccessibleTree="False">
                          <Image.Clip>
                            <EllipseGeometry Center="21,21" RadiusX="21" RadiusY="21"/>
                          </Image.Clip>
                        </Image>
                      </Border>
                      <!-- tiny crown for rank 1 -->
                      <Label IsVisible="{Binding IsLeader}"
                             Text="&#xF521;" FontFamily="FontAwesome6FreeSolid" FontSize="16" TextColor="#F1C40F"
                             TranslationX="-6" TranslationY="-6"
                             AutomationProperties.IsInAccessibleTree="False"/>
                    </Grid>

                    <Label Grid.Column="2" Text="{Binding Name}" FontSize="12"
                           TextColor="{StaticResource TextSecondary}" VerticalOptions="Center"
                           SemanticProperties.Description="Player name"/>

                    <Border Grid.Column="3" BackgroundColor="#0E6A85" StrokeThickness="0"
                            StrokeShape="RoundRectangle 12" Padding="10,4" VerticalOptions="Center">
                      <Label Text="{Binding PointsText}" FontSize="11" TextColor="White"
                             SemanticProperties.Description="Player score"/>
                    </Border>
                  </Grid>
                </DataTemplate>
              </CollectionView.ItemTemplate>
            </CollectionView>
          </ScrollView>
        </VerticalStackLayout>
      </Border>

      </VerticalStackLayout>
    </ScrollView>
  </VerticalStackLayout>
</ContentPage>
