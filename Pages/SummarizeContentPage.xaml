<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="mindvault.Pages.SummarizeContentPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Shell.NavBarIsVisible="False">
  <ContentPage.Resources>
    <Color x:Key="Primary">#31B6D8</Color>
    <Color x:Key="PrimaryDark">#0B57C1</Color>
    <Color x:Key="Surface">#FFFFFF</Color>
    <Color x:Key="TextPrimary">#1C1C1C</Color>
    <Color x:Key="TextSecondary">#4A5864</Color>
    <Color x:Key="Panel">#0F1922</Color>
    <Color x:Key="PanelBorder">#1F2A33</Color>

    <Style x:Key="PrimaryPill" TargetType="Border">
      <Setter Property="HeightRequest" Value="58" />
      <Setter Property="StrokeShape" Value="RoundRectangle 40" />
      <Setter Property="Padding" Value="24,16" />
      <Setter Property="Background">
        <Setter.Value>
          <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="{StaticResource Primary}" Offset="0" />
            <GradientStop Color="{StaticResource PrimaryDark}" Offset="1" />
          </LinearGradientBrush>
        </Setter.Value>
      </Setter>
      <Setter Property="Shadow">
        <Setter.Value>
          <Shadow Opacity="0.25" Radius="16">
            <Shadow.Offset><Point X="0" Y="8" /></Shadow.Offset>
          </Shadow>
        </Setter.Value>
      </Setter>
    </Style>
    <!-- AI Summary progress bar style -->
    <Style x:Key="AiSummaryProgressBar" TargetType="ProgressBar">
      <Setter Property="HeightRequest" Value="12" />
      <Setter Property="BackgroundColor" Value="#E6EEF3" />
      <Setter Property="ProgressColor" Value="#1E90FF" />
    </Style>
    <Style x:Key="RoundedTrack" TargetType="Border">
      <Setter Property="Padding" Value="4" />
      <Setter Property="StrokeShape" Value="RoundRectangle 12" />
      <Setter Property="BackgroundColor" Value="#E6EEF3" />
    </Style>
  </ContentPage.Resources>

  <ContentPage.Background>
    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
      <GradientStop Color="#3CC5F0" Offset="0" />
      <GradientStop Color="#0B57C1" Offset="1" />
    </LinearGradientBrush>
  </ContentPage.Background>

  <Grid RowDefinitions="Auto,*">
    <Border Grid.Row="0" BackgroundColor="White" StrokeThickness="0" Padding="16,12" StrokeShape="RoundRectangle 0,0,18,18" Margin="0,0,0,8">
      <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
        <!-- Deck title on left -->
        <Label x:Name="DeckTitleLabel" FontAttributes="Bold" FontSize="18" TextColor="{StaticResource TextPrimary}" VerticalOptions="Center" />
        <!-- Close X on right -->
        <Border Grid.Column="1" WidthRequest="34" HeightRequest="34" Stroke="#E8EDF2" StrokeThickness="1" StrokeShape="Ellipse" BackgroundColor="White"
                ToolTipProperties.Text="Close and return to previous page"
                SemanticProperties.Description="Close button"
                SemanticProperties.Hint="Returns to the previous page">
          <Label Text="&#xF00D;" FontFamily="FontAwesome6FreeSolid" FontSize="14" TextColor="{StaticResource TextPrimary}" HorizontalOptions="Center" VerticalOptions="Center" />
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnClose" />
          </Border.GestureRecognizers>
        </Border>
      </Grid>
    </Border>

    <ScrollView Grid.Row="1">
      <VerticalStackLayout Padding="24,8,24,40" Spacing="22">
        <Label Text="Summarize from Content" FontSize="26" FontAttributes="Bold" TextColor="White" Margin="0" HorizontalOptions="Fill" HorizontalTextAlignment="Center"
               SemanticProperties.HeadingLevel="Level1"
               SemanticProperties.Description="Summarize from Content page heading" />

        <!-- Content input panel (white input with thin border) -->
        <Border BackgroundColor="White" StrokeShape="RoundRectangle 16" StrokeThickness="1" Stroke="#D5E2EA" Padding="0" HeightRequest="260">
          <Grid>
            <Editor x:Name="ContentEditor" BackgroundColor="Transparent" TextColor="Black" Placeholder="Tap to type or paste your content" PlaceholderColor="#6E7C85" Margin="14"
                    SemanticProperties.Description="Content text field"
                    SemanticProperties.Hint="Type or paste the content you want to generate flashcards from" />
          </Grid>
        </Border>

        <!-- OR divider -->
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>
          <BoxView Grid.Column="0" HeightRequest="1" BackgroundColor="#2F6EA8" VerticalOptions="Center" />
          <Label Grid.Column="1" Text="OR" FontSize="13" TextColor="#E0EEF7" Margin="12,0" />
          <BoxView Grid.Column="2" HeightRequest="1" BackgroundColor="#2F6EA8" VerticalOptions="Center" />
        </Grid>

        <!-- Upload File -->
        <Border Style="{StaticResource PrimaryPill}"
                ToolTipProperties.Text="Upload document file (.pdf, .docx, .pptx, .txt)"
                SemanticProperties.Description="Upload lesson file button"
                SemanticProperties.Hint="Select a document file to extract flashcards from">
          <Label Text="UPLOAD LESSON FILE" FontAttributes="Bold" FontSize="15" TextColor="White" HorizontalOptions="Center" />
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnUploadFile" />
          </Border.GestureRecognizers>
        </Border>
        <Label Text="(.pdf, .docx, .pptx, .txt)" FontSize="12" TextColor="#E0EEF7" HorizontalTextAlignment="Center" />

        <!-- Manual Install Button (shown if Python not detected) -->
        <Border x:Name="ManualInstallButton" Style="{StaticResource PrimaryPill}" IsVisible="False"
                ToolTipProperties.Text="Install Python and Llama AI dependencies"
                SemanticProperties.Description="Install Python and Llama button"
                SemanticProperties.Hint="Installs the required AI dependencies for flashcard generation">
          <Label Text="INSTALL PYTHON + LLAMA" FontAttributes="Bold" FontSize="15" TextColor="White" HorizontalOptions="Center" />
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnManualInstall" />
          </Border.GestureRecognizers>
        </Border>
        <!-- Generate cards button shown when there is content -->
        <Border x:Name="GenerateButton" Style="{StaticResource PrimaryPill}" IsVisible="False"
                ToolTipProperties.Text="Generate flashcards from content using AI"
                SemanticProperties.Description="Generate flashcards button"
                SemanticProperties.Hint="Uses AI to analyze content and create flashcards">
          <Label Text="GENERATE FLASHCARDS" FontAttributes="Bold" FontSize="15" TextColor="White" HorizontalOptions="Center" />
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnGenerate" />
          </Border.GestureRecognizers>
        </Border>
        <Label x:Name="StatusLabel" Text="" FontSize="12" TextColor="#E0EEF7" />
      </VerticalStackLayout>
    </ScrollView>

    <!-- Loading overlay with modal card -->
    <Grid x:Name="LoadingOverlay" Grid.RowSpan="2" BackgroundColor="#CC000000" IsVisible="False" ZIndex="50" InputTransparent="False">
      <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="0">
        <!-- White modal card -->
        <Border BackgroundColor="White" StrokeShape="RoundRectangle 20" Padding="40,30" Shadow="{Shadow Opacity=0.3, Radius=20, Offset='0,10'}" WidthRequest="400">
          <VerticalStackLayout Spacing="24">
            <!-- Title -->
            <Label Text="Processing Content" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource TextPrimary}" HorizontalTextAlignment="Center"
                   SemanticProperties.HeadingLevel="Level2"
                   SemanticProperties.Description="Processing content dialog" />
            
            <!-- Progress bar -->
            <Border x:Name="OverlayTrack" HeightRequest="24" StrokeShape="RoundRectangle 12" BackgroundColor="#E6EEF3" Padding="3">
              <Border x:Name="OverlayFill" HorizontalOptions="Start" WidthRequest="0" StrokeThickness="0" StrokeShape="RoundRectangle 9">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="{StaticResource Primary}" Offset="0" />
                    <GradientStop Color="{StaticResource PrimaryDark}" Offset="1" />
                  </LinearGradientBrush>
                </Border.Background>
                <BoxView x:Name="OverlayShimmer" WidthRequest="120" Opacity="0.12" Background="White" HorizontalOptions="Start" />
              </Border>
            </Border>
            
            <!-- Progress status -->
            <Label x:Name="OverlayProgressLabel" Text="Processing chunk 1/23 ETA &lt;1s" TextColor="{StaticResource TextSecondary}" FontSize="14" HorizontalTextAlignment="Center" />
            
            <!-- Additional info -->
            <Label Text="This may take a few moments..." FontSize="12" TextColor="#7A8C98" HorizontalTextAlignment="Center" />
          </VerticalStackLayout>
        </Border>
      </VerticalStackLayout>
    </Grid>
  </Grid>
</ContentPage>