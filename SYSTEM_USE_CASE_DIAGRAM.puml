@startuml MindVault_UseCase_Improved

title MindVault - System Use Case Diagram (Corrected - Fully Offline)
left to right direction

' Visual Styling
skinparam packageStyle rectangle
skinparam usecase {
    BackgroundColor White
    BorderColor DarkBlue
    ArrowColor Navy
}

' ============================
' PRIMARY ACTORS (LEFT SIDE)
' ============================
actor "Student/Learner" as Student
actor "Content Creator" as Creator
actor "Multiplayer Host" as Host
actor "Multiplayer Player" as Player

' ============================
' SYSTEM BOUNDARY (PACKAGES)
' ============================
rectangle "MindVault Application" {

    ' --- Group 1: Setup & Profile ---
    package "User Profile & Onboarding" {
        usecase "Complete Onboarding" as UC61
        usecase "Set/Edit Profile\n(name, avatar)" as UC60
    }

    ' --- Group 2: Management ---
    package "Flashcard Management" {
        usecase "Create/Edit Reviewer" as UC1
        usecase "Import/Export Cards\n(with optional password)" as UC4
        usecase "View/Sort/Search\nReviewers" as UC7
        usecase "Delete Reviewer" as UC6
    }

    ' --- Group 3: AI Features ---
    package "AI Content Generation" {
        usecase "Generate Flashcards\nfrom Text/File" as UC12
        usecase "Verify Bundled AI\nComponents" as UC13
    }

    ' --- Group 4: Study Mode ---
    package "Study & Review" {
        usecase "Study Flashcards\n(Interactive Mode)" as UC21
        usecase "View Study Statistics\n(learned, skilled, memorized)" as UC24
        usecase "Configure Study Settings" as UC22
        usecase "Review Mistakes" as UC25
    }

    ' --- Group 5: Multiplayer ---
    package "Multiplayer Mode" {
        usecase "Host Game Session\n(generate room code)" as UC30
        usecase "Join Game Session\n(enter code)" as UC33
        usecase "Play Game\n(Buzz/Answer/Score)" as UC35
        usecase "View Leaderboard" as UC41
    }

    ' --- Group 6: Security ---
    package "Security & Data Management" {
        usecase "Encrypt/Decrypt Data\n(SQLCipher AES-256)" as UC50
        usecase "Migrate Unencrypted DB\n(creates backup)" as UC51
        usecase "Store Encryption Key\n(SecureStorage)" as UC52
    }
}

' ============================
' SECONDARY ACTORS (RIGHT SIDE)
' ============================
actor "System\n(Background Services)" as System
actor "Bundled AI Engine\n(Python311 + llama-cpp-python)" as AI

' ============================
' RELATIONSHIPS - PRIMARY ACTORS
' ============================

' Student/Learner
Student --> UC60 : manages profile
Student --> UC61 : completes
Student --> UC7 : browses
Student --> UC4 : imports/exports
Student --> UC21 : studies
Student --> UC22 : configures
Student --> UC24 : views
Student --> UC25 : reviews

' Content Creator
Creator --> UC1 : creates/edits
Creator --> UC12 : generates with AI
Creator --> UC4 : exports (shares)
Creator --> UC6 : deletes

' Multiplayer Host
Host --> UC30 : creates game
Host --> UC35 : controls game
Host --> UC41 : displays

' Multiplayer Player
Player --> UC33 : joins game
Player --> UC35 : participates
Player --> UC41 : views

' ============================
' RELATIONSHIPS - SYSTEM & AI
' ============================

' System (Internal Background Logic)
System --> UC50 : encrypts/decrypts
System --> UC51 : migrates (one-time)
System --> UC52 : stores key
System --> UC23 : tracks progress
System --> UC13 : verifies components

' AI Engine Dependencies (Use cases depend on AI)
UC12 --> AI : <<requests generation>>
UC13 --> AI : <<verifies>>

' ============================
' INCLUDE & EXTEND RELATIONSHIPS
' ============================

' AI Generation includes verification
UC12 ..> UC13 : <<include>>\n[first run verification]

' Study includes progress tracking
UC21 ..> UC23 : <<include>>
UC21 ..> UC24 : <<include>>
UC21 ..> UC25 : <<extend>>\n[if mistakes made]

' Multiplayer includes game flow
UC30 ..> UC35 : <<include>>
UC33 ..> UC35 : <<include>>
UC35 ..> UC41 : <<include>>

' Import/Export includes encryption
UC4 ..> UC50 : <<include>>

' Database security flow
UC50 ..> UC52 : <<include>>

' ============================
' NOTES
' ============================

note right of AI
  ? FULLY OFFLINE AI SYSTEM
  
  All components bundled in app:
  • Python311/ - Complete Python 3.11 runtime
  • Wheels/ - Pre-built llama-cpp-python
  • Models/ - Qwen 2 0.5B AI model (~350MB)
  • Scripts/ - flashcard_ai.py
  
  NO internet required!
  NO downloads during runtime!
  
  Windows only (bundled with app)
  First run: ~2-3 sec verification
  Subsequent runs: Instant
end note

note right of UC50
  All database content encrypted
  at rest using SQLCipher AES-256.
  
  Encryption key stored in
  platform-specific secure storage:
  - Android: KeyStore
  - iOS: Keychain
  - Windows: Credential Manager
end note

note right of UC23
  Spaced Repetition System (SRS)
  tracks 5 mastery stages:
  
  Avail ? Seen ? Learned
     ? Skilled ? Memorized
end note

note right of UC13
  Verifies bundled AI components:
  1. Python311/python.exe exists
  2. llama_cpp package installed
  3. AI model file present
  4. VC++ Redistributables (Windows)
  
  All checks are LOCAL - no internet!
end note

note right of UC51
  One-time migration from unencrypted
  to encrypted database.
  
  Automatically creates backup:
  mindvault_backup_unencrypted.db3
  
  Located in: FileSystem.AppDataDirectory
  
  NOT a recurring backup system!
end note

note right of UC4
  Export/Import automatically includes:
  • All flashcards (Q&A)
  • Study progress (SRS states)
  • Optional password encryption
  
  Progress is preserved when user
  chooses "Continue with Progress"
  during import.
  
  Format: JSON
end note

note bottom of Student
  Primary user role: studies content
  and tracks learning progress.
  
  Can also create content and
  participate in multiplayer.
end note

note bottom of Creator
  Specialized role: focuses on
  creating and managing flashcard
  content for others to use.
  
  Often teachers or content experts.
  
  Can use OFFLINE AI to generate
  flashcards from text/documents.
end note

note bottom of Host
  Multiplayer-specific role:
  creates and manages game sessions
  on local network via UDP broadcast.
end note

note bottom of Player
  Multiplayer-specific role:
  joins hosted games and competes
  with other players in real-time.
end note

legend right
  |= Symbol |= Meaning |
  | <<include>> | Mandatory sub-functionality |
  | <<extend>> | Optional/conditional functionality |
  | ? | Actor initiates action |
  | <<requests>> | Dependency on external system |
  | <<verifies>> | System validation check |
  
  **Actor Types:**
  • Primary: Human users (left side)
  • Secondary: System components (right side)
  
  **IMPORTANT:**
  ? This is a FULLY OFFLINE system
  All AI components are bundled with the app
  
  Progress data is automatically included
  in exports/imports (not a separate action)
endlegend

@enduml
